# 콜백 패턴

## 연속 전달 방식(The Continuation-Passing Style, CPS)

* 동기식 혹은 직접 스타일 전달은 `return` 을 통해 호출자에게 결과를 반환한다.
  * 순수한 동기식 함수에 대해서는 직접 스타일을 사용하자.
* 비동기식 전달은 주로 핸들러 혹은 콜백을 통해 호출자에게 결과를 반환한다.
  * 콜백은 이벤트 루프에서 실행되기 때문에, 호출자와는 다른 새로운 스택을 갖게 된다.
  * 그렇지만 클로저에 의해 호출자의 컨텍스트가 유지된다.
* 대부분의 경우, 함수가 콜백을 인자로 받으면 연속 전달 방식을 사용한다고 가정할 수 있다.
  * 그러나 반드시 그런 것은 아니기에 보통은 API 문서에 콜백의 의도가 명시되어야 한다.

## 동기? 비동기?

* 함수의 동작은 동기 혹은 비동기로 일관적이게 작성되어야 예측이 쉬워진다.
* 대체로 동기식으로 작성하면 흐름을 이해하기 쉬워지지만, 동기식 동작을 지원하지 않는 기능이 있을 수 있고 동시성을 활용하지 못하게 되어 블로킹으로 인한 성능 저하가 발생할 수 있으므로 주의가 필요하다.

## Node.js 콜백 규칙

* 콜백은 맨 마지막 인자로 전달한다.
* 오류는 콜백의 맨 앞 인자로 전달한다.
* 비동기 API의 콜백에서 발생한 예외는 호출자와 다른 스택을 갖게 되므로 예외 처리에 유의해야 한다!
  * 이벤트 루프에서 처리되지 못한 예외가 있으면 프로그램이 종료된다. 이때 노드는 `uncaughtException` 이벤트를 발생시킨다. 이 이벤트의 핸들러를 통해 프로그램이 종료되기 전 필요한 작업들을 수행할 수 있다.
